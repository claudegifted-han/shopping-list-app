# 컴퓨터물리해석 설문 코딩 에이전트

## 에이전트 역할

2025 컴퓨터물리해석 수업 설문의 서술형 응답(Q16, Q17 등)을 질적 코딩하여 논문삽입용 Excel 파일을 생성한다. 물리 선생님이 Q7~Q13에 적용한 코딩 방법론을 정확히 재현한다.

## 사전 필독

작업 시작 전 반드시 다음 파일을 읽는다:
1. `references/coding-methodology.md` — 코딩 방법론, Q7 참조 표준, 설문 문항 목록
2. `SKILL.md` — 실행 절차 및 핵심 규칙

## 워크플로우

### 입력

```
2025_컴물_설문_전처리_Q{N}_.xlsx
```
- 컬럼: `응답자`, `Q{N}`
- 56명 학생 응답

### 실행 명령어 예시

```bash
# Claude Code에서 실행
claude "Q16 설문 데이터를 코딩해줘" --file 2025_컴물_설문_전처리_Q16_.xlsx
```

### 처리 절차

#### Phase 1: 데이터 로드 및 확인
```python
import pandas as pd
df = pd.read_excel('입력파일.xlsx')
print(f"응답자 수: {len(df)}")
print(f"빈 응답: {df.iloc[:,1].isna().sum()}")
```
- 총 응답 수, 빈 응답, 불분명 응답을 확인하여 사용자에게 보고

#### Phase 2: 전수 읽기 및 질적 코딩

**56명 전체 응답을 하나씩 읽고** 다음을 수행:

1. **의미 단위 추출**: 각 응답에서 핵심 의미 단위 식별 (1명에서 복수 추출 가능)
2. **하위 코드 생성**: 유사한 의미 단위를 묶어 하위 코드 생성
3. **상위 범주 구성**: 관련 하위 코드를 묶어 상위 범주 구성
4. **학생 수 산정**: 하위 코드별·상위 범주별 고유 학생 수를 **직접 세기**
5. **대표 인용 선정**: 하위 코드당 2~4개, 학생 **원문 직접 발췌**

**코딩 수치 기준:**

| 항목 | 기준 |
|------|------|
| 상위 범주 수 | 3~5개 |
| 하위 코드 수 | 상위 범주당 2~3개 |
| 대표 인용 수 | 하위 코드당 2~4개 |
| 코드명 스타일 | 서술적·변환 지향적 ("~을 통한 ~", "~의 형성") |

**학생 수 산정 규칙:**
- 하위 코드: 해당 코드에 부합하는 **고유 학생 수**
- 상위 범주: 하위 코드 중 하나라도 해당하는 **고유 학생 수** (≤ 하위 합계)
- 코딩 시 학생별 해당 코드 매핑을 내부적으로 유지하여 정확한 수 산정

#### Phase 3: JSON 결과 생성

```json
{
    "question_id": "Q16",
    "categories": [
        {
            "name": "상위 범주명",
            "student_count": 38,
            "subcodes": [
                {
                    "name": "하위 코드명",
                    "student_count": 35,
                    "quotes": ["대표 인용 원문 1", "대표 인용 원문 2"]
                }
            ]
        }
    ]
}
```

JSON 파일로 저장: `(Q{N})_coding_result.json`

#### Phase 4: 검증

```bash
python scripts/validate_coding.py "(Q{N})_coding_result.json" 56
```

- ❌ 오류가 있으면 Phase 2로 돌아가 수정
- ⚠️ 경고는 내용을 확인하고 합리적이면 진행

#### Phase 5: Excel 생성

```bash
python scripts/generate_excel.py "(Q{N})_coding_result.json" "(Q{N})_Code_Frequencies_논문삽입.xlsx"
```

### 출력

```
(Q{N})_Code_Frequencies_논문삽입.xlsx
```

Excel 형식 사양 (Q7 참조 표준과 동일):
- 시트명: `Documents with code`
- 헤더: `상위 범주 | 학생 수 (n) | 세부항목(하위 코드) | 학생 수 (n) | 대표 인용`
- 폰트: 맑은 고딕, 10pt
- A~D열: 가운데 정렬, 세로 가운데, 줄바꿈
- E열: 왼쪽 정렬, 세로 가운데, 줄바꿈
- 상위 범주 + 학생 수: 하위 코드 행 수만큼 세로 병합
- 대표 인용: `▶`로 시작, `\n▶`로 구분
- 전체 셀: thin 테두리
- 컬럼 너비: A=26.44, B=10.44, C=31.78, D=10.22, E=79.78

## 절대 금지 사항

1. 학생 수를 추정하거나 비율로 역산하지 않는다 — 반드시 직접 센다
2. 대표 인용을 요약하거나 의역하지 않는다 — 원문 직접 발췌
3. Excel 형식을 변경하지 않는다 — Q7 참조 표준을 정확히 재현
4. 빈도가 낮은 응답을 무시하지 않는다 — 질적으로 중요할 수 있음
